
2021/08/27

1. main.py: problemsheet.json을 읽어서 한 문제식 풀이 호출
2. nl_preprocess.py: 수학 문제 문장 전처리, 단어나 숫자 매핑, 띄어쓰기나 맞춤법 정규화, 형태소 분석(?)

3. nl_to_fr.py: 자연어를 형식표현(formal representation)으로 변환.
일단은 sentence 매칭 기반으로 매치되는 문장을 찾아서 변환
3.1. 가장 유사한 문장을 찾는 알고리즘
3.2. 매칭에 기반해서 표현을 구하는

문제 유형을 먼저 파악
(similarity table을 대회 특화용으로 구성하는 것도 방법? 답을 구하시오. - 계산하시오.)

4. fr_solver.py: formal representaion에서 추론 과정을 거쳐서 답을 계산

3,4는 반복하면서 가장 좋은 매칭과 답을 구할 수 있도록 탐색 진행



2021/08/30

Dataset 구성 방법
최대한 자연어 표현으로 쉽게 데이터셋을 입력하면, 프로그램이 한 단계 전처리를 통해서 데이터셋 구축

데이터셋 입력 예) 

감이 귤보다 43개 더 적다면: 감=귤-43
어느 동물원에 기린은 5마리, 코끼리는 2마리 있습니다. : 기린=5, 코끼리=2
기린은 코끼리보다 몇 마리 더 많습니까? : 기린=코끼리+x
목장에 양이 5마리, 염소가 10마리 있습니다. : 양=5, 염소=10



감, 귤, 43과 같이 매칭되는 숫자나 단어를 찾아서 자동으로 템플릿으로 변환
변환 예) <$a:사물>이 <$b:사물>보다 <$c:숫자>개 더 적다면: $a=$b-$c

목장에 있는 양와 염소는 모두 몇 마리입니까? : x=양+염소
어느 동물원에 곰은 5마리 있고 호랑이는 곰보다 6마리 더 많다면 : 곰=5, 호랑이=곰+6
호랑이는 몇 마리 있습니까? : x=호랑이
정국이는 전체 쪽수가 334쪽인 동화책을 모두 읽으려고 합니다. : 동화책=334, 
하루에 42쪽씩 읽으면 며칠 안에 모두 읽을 수 있습니까? : x=it//42+(it%42>0)

수학여행에 신청한 남자 어린이는 11명, : 남자

키가 작은 사람부터 순서대로 9명이 한 줄로 서 있습니다. 호석이가 앞에서부터 5번째에 서 있습니다. 키가 큰 사람부터 순서대로 다시 줄을 서면 호석이는 앞에서부터 몇 번째에 서게 됩니까? : x=9-5+1
키가 작은 사람부터 순서대로 9명이 한 줄로 서 있습니다. 호석이가 앞에서부터 5번째에 서 있습니다. 키가 큰 사람부터 순서대로 다시 줄을 서면 호석이는 앞에서부터 몇 번째에 서게 됩니까? : x=9-5+1
키가 작은 사람부터 순서대로 9명이 한 줄로 서 있습니다. 호석이가 앞에서부터 5번째에 서 있습니다. 키가 큰 사람부터 순서대로 다시 줄을 서면 호석이는 앞에서부터 몇 번째에 서게 됩니까? : x=9-5+1
키가 작은 사람부터 순서대로 9명이 한 줄로 서 있습니다. 호석이가 앞에서부터 5번째에 서 있습니다. 키가 큰 사람부터 순서대로 다시 줄을 서면 호석이는 앞에서부터 몇 번째에 서게 됩니까? : x=9-5+1
키가 작은 사람부터 순서대로 9명이 한 줄로 서 있습니다. 호석이가 앞에서부터 5번째에 서 있습니다. 키가 큰 사람부터 순서대로 다시 줄을 서면 호석이는 앞에서부터 몇 번째에 서게 됩니까? : x=9-5+1
키가 작은 사람부터 순서대로 9명이 한 줄로 서 있습니다. 호석이가 앞에서부터 5번째에 서 있습니다. 키가 큰 사람부터 순서대로 다시 줄을 서면 호석이는 앞에서부터 몇 번째에 서게 됩니까? : x=9-5+1
키가 작은 사람부터 순서대로 9명이 한 줄로 서 있습니다. 호석이가 앞에서부터 5번째에 서 있습니다. 키가 큰 사람부터 순서대로 다시 줄을 서면 호석이는 앞에서부터 몇 번째에 서게 됩니까? : x=9-5+1



키가 작은 사람부터 순서대로 9명이 한 줄로 서 있습니다. : 사람수=9, 순서='키가 작은 사람부터'

서로 다른 두 자연수 A, B가 있습니다. A+B=30, A=B+B+B+B일 때, A를 구하시오.
서로 다른 두 자연수 A, B가 있습니다.
A+B=30, A=B+B+B+B일 때, A를 구하시오. : A+B=30, A=B+B+B+B, x=A

어떤 수에서 46을 뺐더니 15가 되었습니다. : 어떤수-46=15
어떤 수에서 29를 빼면 얼마가 되는지 구하시오. : x=어떤수-29
어떤 수의 소수점을 오른쪽으로 한 자리 옮기면 원래보다 2.7만큼 커집니다. : 어떤수+2.7=어떤수*10
원래의 소수를 구하시오. : x=어떤수



PCFG에서는 
context free grammar가 확률적으로 주어지고 (미리 학습될 수도 있고, 손으로 정의할수도 있고)
새로운 문장이 주어졌을 때 이 문장을 가장 잘 설명하는 생성 tree를 CYK 알고리즘으로 추정

우리 수학문제에서는
데이터셋이 자연어 표현으로 주어지고 (손으로 잘 정의)
새로운 문장이 주어졌을 때 이 문장을 가장 잘 설명(매칭)하는 span list를 ?? 알고리즘으로 추정

@phrase 두 개가 주어졌을 때 두개의 similarity를 계산하는 모듈
similarity_function('달리기 시합에서 남준이는 2등을 했고', '달리기 대회에서 남준이는 2등을 했습니다.')
=> 0.5


@주어진 similiarity를 이용해서 최적의 매칭 span list를 찾는 알고리즘
문제유형을 미리 classification 수행해서 같은 유형에 해당되면 similarity가 높게(수치가 낮게) 되도록



문제정의
수학문제 Q가 주어지고, 부분 매칭 데이터셋 D가 주어졌을 때, Q를 가장 잘 설명하는 D의 부분집합을 구하시오.

(데이터셋에 나열된 문장 리스트)
id: 문장
001: 달리기 시합에서 정국이는 5등을 했고, 
002: 지민이는 3등을 했습니다.
홀수를 모두 찾아 합을 구하시오.
A의 값을 구하시오.
차가 가장 크게 되는 두 수를 찾아 그 차를 구하시오.

Q: 달리기 시합에서 남준이는 2등을 했고, 윤기는 4등을 했습니다. 호석이는 윤기보다 잘했지만 남준이보다는 못했습니다. 호석이의 등수는 몇 등입니까?

달리기 시합에서 남준이는 2등을 했고, 윤기는 4등을 했습니다. 호석이는 윤기보다 잘했지만 남준이보다는 못했습니다. 호석이의 등수는 몇 등입니까?


사과, 복숭아, 배, 참외 중에서 2가지의 과일을 골라서 사는 경우는 모두 몇 가지입니까? : combinatorial(4, 2)


3개의 수 2, 3, 9로 나누어 떨어질 수 있는 세 자리 수는 모두 몇 개 있습니까? : 

n1 = 2, n2 = 3, n3 = 9, r = 3

count = 0
for i in range(10**(r-1), 10**r):
    if i % n1 == 0 and i % n2 == 0 and i % n3 == 0:
        count += 1
print(count)


달리기 시합에서 남준이는 2등을 = 001 (매칭 스코어 2)
달리기 대회에서 남준이는 2등을 했고, = 001 (매칭 스코어 0.1)

M001 -> 달리기 대회에서 남준이는 2등을 했고, (매칭확률은 )
        달리기 시합에서 남준이는 2등을 했고,
        달리기 시합에서 정국이는 2등을 했고,

원하는 출력
[ 문장의 span, 매칭된 데이터셋 id ]
[
  ((0, 5), 001),
  ((5, 7), 011),
  ((7, 9), 012),
  ((9, 11), 014)
]

Q:숫자 카드 2, 0, 4를 한 번씩만 써서 가장 큰 세 자리 수를 만들어 보시오.


D001:숫자 카드 2, 0, 4를 한 번씩만 써서 가장 큰 세 자리 수를 만들어 보시오.
D002:숫자 카드 2, 0, 4를 한 번씩만

D003:가장 큰 세 자리 수 => 수
D004:수를 만들어 보시오.



input: equation, topic

G1)
어떤 수에서 29를 빼면 얼마가 되는지 구하시오.
어떤 수에서 29를 빼면 얼마가 됩니까?
어떤 수에서 29를 빼면 얼마입니까?

G2)
어떤 수에서 29를 더하면 얼마가 됩니까?


Q: 어떤 수에서 29를 더하면 얼마입니까?


q: 어떤 수에서 29를 빼면 얼마입니까?         y: x-29
   ㅇ

x1: 어떤 수에서 23를 빼면 얼마입니까?           y1: addition  

x2: 어떤 수에서 29를 나누면 얼마입니까?         y2: multiplication


A를 8로 나누면 몫은 B이고 나머지는 C가 됩니다. A, B, C는 자연수입니다. 이 식에서 몫과 나머지가 같습니다. 나누어지는 수 A 중 가장 큰 수를 구하시오.
A를 8로 나누면 몫은 B이고 나머지는 C가 됩니다. A, B, C는 자연수입니다. 이 식에서 몫과 나머지가 같습니다. 몫보다 3 큰 수는 무엇입니까?
A를 8로 나누면 몫은 B이고 나머지는 C가 됩니다. A, B, C는 자연수입니다. 이 식에서 몫과 나머지가 같습니다. 



y:    종류:수찾기2,    수식:max(A), A // n = B, A % n = C, B = C    토픽: 수
                       수식: ㅁㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇㄹ         토픽: 과일
                       ㅁㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇ            
                       ㅁㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇㄹㄴㅁㅇㄻㄴㅇ
                       ㅁㄴㅇㄻㄴㅇㄻㄴㅇㄹㄴㅁㅇㄻㄴㅇㄹ
                       ㅁㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇ
                       ㅁㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴㅇㄻㄴ

정국이는 4와 4를 모았습니다. 지민이는 3과 6을 모았습니다. 누가 모은 수가 더 큽니까? : 정국=4+4, 지민=3+6, argmax[정국, 지민]     if: 정국 > 지민 ? 

3개의 수 2, 5, 9로 나누어 떨어질 수 있는 세 자리 수는 모두 몇 개 있습니까? : 



5/23의 분자와 분모에 같은 수를 더하면 정확히 2/3으로 줄어들 수 있습니다. 더한 수는 무엇입니까? : 

4개의 수 53, 98, 69, 84가 있습니다. 그 중에서 가장 큰 수와 가장 작은 수의 차는 얼마입니까? : Math.max([53, 98, 68, 84]) - Math.min([53, 98, 68, 84])

5개의 수 3, 23, 42, 64, 34 가 있습니다. 그중에서 가장 큰 수화 가장 작은 수의 곱은 얼마입니까?  
5개의 수 3, 23, 42, 64, 34 가 있습니다. 그중에서 가장 큰 수화 가장 작은 수의 차는 얼마입니까?  
5개의 수 3, 23, 42, 64, 34 가 있습니다. 그중에서 가장 큰 수를 가장 작은 수로 나눈 값은 얼마입니까?  
5개의 수 3, 23, 42, 64, 34 가 있습니다. 그중에서 가장 큰 수화 가장 작은 수의 곱은 얼마입니까?  
5개의 수 3, 23, 42, 64, 34 가 있습니다. 그중에서 가장 큰 수화 가장 작은 수의 곱은 얼마입니까?  
5개의 수 3, 23, 42, 64, 34 가 있습니다. 그중에서 가장 큰 수화 가장 작은 수의 곱은 얼마입니까?  



-> 수찾기 유형
prior knowledge: 수찿기 유형은 수가 나열된 문장과, 뒤이어 문제가 나열된 문장이 있음. 
-> 첫번째 문장 -> list -> [3, 23, 42, 64, 34]
-> 두번째 문장 -> 방정식 -> max(list) * min(list)

이슈는 문제의 유형이 변화하는 범위 내에서 가장 잘 exploit할 수 있는 형태



x = 3*4+3
Math.max


f(x) = a*x^3 + b*x^2 + c*x + d
f(1) = 1
f(2) = 5
f(3) = 14
f(4) = 30

#1. equation(?) 포맷을 확정

#2. sentence matching 알고리즘 개발

2-1. 매칭 결과에 따라서 수치를 바꿔주고,
2-2

#3. 데이터셋 구축

3-1. Ape21k, Math...
3-2. 콴다 크롤링
3-3. 외국 사이트 생성
3-4. 초등 수학 문제
3-5. 알바 고용
3-6. 직접 노가다




